# 응용 프로토콜

> 네트워크 관리사 대비 스터디 9일차 정리 내용으로, [이기적 네트워크관리사 1ㆍ2급 필기+실기] 교재 커리큘럼을 따라갑니다.

🔹 OSI 7계층의 **응용 계층(Application Layer)** 에서 동작하는 프로토콜들이다.

## Well-Known Port

| **포트 번호** | **프로토콜**  | **서비스**                       |
| ------------- | ------------- | -------------------------------- |
| **20**        | FTP           | 데이터 전송(Data Channel)        |
| **21**        | FTP           | 명령 전송(Control Channel)       |
| **22**        | SSH           | 보안 셸 접속                     |
| **23**        | TELNET        | 원격 터미널 접속                 |
| **25**        | SMTP          | 이메일 전송                      |
| **53**        | DNS           | 도메인 이름 변환                 |
| **67**        | DHCP          | DHCP 서버 (IP 할당)              |
| **68**        | DHCP          | DHCP 클라이언트 (IP 요청)        |
| **80**        | HTTP          | 웹 통신 (비보안)                 |
| **110**       | POP3          | 이메일 수신                      |
| **143**       | IMAP          | 이메일 수신(고급)                |
| **161**       | SNMP          | 네트워크 관리                    |
| **443**       | HTTPS         | 웹 통신 (보안)                   |
| **993**       | IMAPS         | 보안 이메일 수신 (IMAP over SSL) |
| **3306**      | MySQL         | 데이터베이스 서버                |
| **5432**      | PostgreSQL    | 데이터베이스 서버                |
| **6379**      | Redis         | 인메모리 데이터베이스            |
| **9200**      | Elasticsearch | 검색 엔진                        |
| **27017**     | MongoDB       | 데이터베이스 서버                |

> 리눅스 시스템에서 `/etc/services`파일을 확인해 사용하고있는 포트 번호를 확인하고 수정할 수 있다.

## Telnet(Teletype Network)

🔹 TCP 기반 원격 접속 프로토콜이다.<br>
🔹 모든 데이터는 **암호화 없이** 평문으로 전송된다.<br>
🔹 기본 포트는 **23번 포트**이다.<br>

## SSH(Secure Shell)

🔹 TCP 기반 원격 접속 프로토콜이다.<br>
🔹 모든 데이터를 **암호화해** 전송한다.<br>
🔹 기본 포트는 **22번 포트**이다.<br>
🔹 서버에서 `service ssh start`명령어로 SSH 서비스를 실행시켜줘야 한다.

## HTTP(Hyper Text Transfer Protocol)

### HTTP 개요

🔹 TCP 기반, 웹에서 클라이언트와 서버 사이의 메시지를 송수신하는 프로토콜이다.<br>
🔹 HTTP는 **개방형 프로토콜(Open Protocol)** 로, 송수신되는 메시지의 구조가 공개되어있다.<br>
🔹 또한 **State-less** 프로토콜로, TCP의 연결을 요청이 있을 때 연결하고 메시지를 처리한 뒤 연결을 종료하는 방식이다.<br>
🔹 기본 포트는 **80번 포트**이다.<br>
🔹 80번 포트는 root사용자만 오픈할 수 있으므로 웹 서버 관련 프로세스는 root사용자의 권한으로 기동된다.

### HTTP 구조

🔹 HTTP는 Header와 Body로 구분되며, 둘 사이는 개행문자 `\r\n\r\n`으로 구분된다.<br>

### HTTP Request Method

| **메서드**  | **설명**                                                                                             |
| ----------- | ---------------------------------------------------------------------------------------------------- |
| **GET**     | 지정한 URL의 리소스를 요청하여 가져온다.(4Kilo byte 제한)                                            |
| **POST**    | Request Body에 데이터를 담아서, 지정한 URL에 새로운 리소스를 생성한다.(전송량 제한 없음)             |
| **PUT**     | Request Body에 데이터를 담아서, 지정한 URL에 해당 리소스를 저장한다. (전체 업데이트)                 |
| **PATCH**   | Request Body에 변경할 데이터를 담아서, 지정한 URL의 리소스에서 해당 필드만 수정한다. (부분 업데이트) |
| **DELETE**  | 지정한 URL의 리소스를 삭제한다.                                                                      |
| **HEAD**    | GET과 유사하게 지정한 URL의 리소스를 요청하지만, 응답 본문 없이 헤더만 반환한다.                     |
| **OPTIONS** | 지정한 URL에서 지원하는 HTTP 메서드를 반환한다.                                                      |
| **TRACE**   | 지정한 URL에 대한 요청을 그대로 반환하여, 네트워크 경로를 테스트한다.                                |
| **CONNECT** | 지정한 URL을 대상으로 터널을 생성하여, 프록시 서버를 통해 연결한다.                                  |

## FTP(File Transfer Protocol)

### FTP 개요

🔹 TCP 기반의 서버에 파일을 업/다운로드하는 인터넷 표준 프로토콜이다.<br>
🔹 FTP 클라이언트 프로그램을 사용해 TCP로 접속한 뒤 ID/PW를 입력 받아 인증을 수행한다.<br>
🔹 기본 포트는 **20번과 21번 포트**이다.

### FTP 특징

🔹 포트를 2개 사용한다는 특징이 있다.<br>
🔹 **명령 포트** : 고정 포트(**21번**)로, USER, PASS, GET등의 명령을 FTP 서버에 전송하기 위한 포트이다.<br>
🔹 **데이터 포트** : 전송 모드에 따라 다른 포트를 사용한다.<br>
&emsp;🔹 **Active Mode** : 20번 포트를 사용한다.<br>
&emsp;🔹 **Passive Mode** : FTP 서버가 포트를 결정해서 FTP 클라이언트에게 포트를 알려준다.<br>
🔹 FTP 클라이언트의 데이터 포트는 클라이언트 자신이 결정한다.<br>
🔹 명령 채널과 데이터 전송 채널이 독립적으로 동작한다.<br>
🔹 클라이언트가 명령 채널로 서버에게 파일 전송을 요구하면, 서버는 데이터 전송 채널로 데이터를 전송한다.<br>

### FTP 로그인 과정

1. FTP 클라이언트와 FTP 서버 간 TCP 3-Way Handshake로 연결을 설정한다.
2. **FTP 클라이언트**가 FTP 서버에 접속 요청을 보낸다.
3. **FTP 서버**가 220 응답 코드를 보내 서비스가 준비됨을 알린다.
4. **FTP 클라이언트**가 USER 명령으로 사용자 ID를 전송한다.
5. **FTP 서버**가 331 응답 코드를 보내 비밀번호 입력을 요청한다.
6. **FTP 클라이언트**가 PASS 명령으로 사용자 PW를 전송한다.
7. **FTP 서버**가 230 응답 코드를 보내 로그인 성공을 알린다.

### FTP Active Mode와 Passive Mode

_그림넣기_

| **구분**             | **Active Mode**                                                                | **Passive Mode**                                                                 |
| -------------------- | ------------------------------------------------------------------------------ | -------------------------------------------------------------------------------- |
| **제어 채널**        | 클라이언트가 서버의 21번 포트로 연결을 요청한다.                               | 클라이언트가 서버의 21번 포트로 연결을 요청한다.                                 |
| **데이터 채널**      | 서버가 자신의 20번 포트를 사용하여 클라이언트의 랜덤 포트로 데이터를 전송한다. | 서버가 랜덤 포트를 개방하고 클라이언트가 해당 포트로 연결하여 데이터를 전송한다. |
| **클라이언트 역할**  | 클라이언트가 `PORT` 명령을 사용하여 자신이 사용할 데이터 포트를 서버에 알린다. | 클라이언트가 `PASV` 명령을 사용하여 서버가 개방한 랜덤 포트를 할당받는다.        |
| **서버 역할**        | 서버가 클라이언트가 지정한 포트로 데이터를 전송한다.                           | 서버가 랜덤 포트를 개방하고 클라이언트의 접속을 대기한다.                        |
| **방화벽 문제**      | 클라이언트 방화벽이 외부에서 들어오는 연결을 차단할 가능성이 있다.             | 클라이언트가 서버에 직접 연결하기 때문에 방화벽 문제를 해결할 수 있다.           |
| **적합한 환경**      | 클라이언트가 공인 IP를 사용할 때 적합하다.                                     | 클라이언트가 방화벽 뒤에 있을 때 적합하다.                                       |
| **설정 명령어**      | 클라이언트가 `PORT` 명령을 사용하여 데이터 전송 포트를 지정한다.               | 클라이언트가 `PASV` 명령을 사용하여 서버의 랜덤 포트로 연결한다.                 |
| **데이터 전송 방식** | 서버가 직접 클라이언트의 포트로 데이터를 전송한다.                             | 클라이언트가 서버의 랜덤 포트로 연결하여 데이터를 전송한다.                      |
| **실제 운영 환경**   | 방화벽 문제로 인해 잘 사용되지 않는다.                                         | 방화벽 문제를 해결할 수 있어 주로 사용된다.                                      |

### FTP의 종류

| **종류** | **내용**                                                                                                  |
| -------- | --------------------------------------------------------------------------------------------------------- |
| **FTP**  | ID 및 PW 인증을 수행하고 TCP 프로토콜을 사용해 사용자의 데이터를 송수신한다.                              |
| **TFTP** | 인증 과정 없이 UDP 기반으로 빠르게 송수신한다. 69번 포트를 사용한다.                                      |
| **SFTP** | 전송 구간에 압호화 기법을 사용하여 기밀성을 제공한다. SSH 기반 파일 전송 프로토콜로 22번 포트를 사용한다. |

## DNS(Domain Name Service)

### DNS 개요

🔹 TCP/UDP 기반 분산 네이밍 시스템이다.<br>
🔹 URL 주소에 대한 IP 주소를 알려주는 서비스이다.<br>

> `nslookup`을 사용해 DNS를 확인할 수 있다.

### DNS 해석 과정

1. DNS는 DNS Cache Table을 확인한다.
2. DNS Cache Table에 없으면 `hosts`파일을 확인한다.
3. `hosts`파일에도 해당 URL에 대한 IP 주소가 등록되어있지 않으면 DNS 서버에 의뢰한다. (**순환 쿼리, Recursive Query**)
4. DNS 서버의 Cache Table에 등록되어있으면 IP 주소를 DNS Response 메시지로 전달한다.
5. 만약 확인할 수 없으면 Top Level 도메인부터 Second Level 도메인으로 해석을 의뢰한다. (**반복 쿼리, Iterative Query**)

> **순환 쿼리(Recursive Query)란?**<br>Local DNS 서버에 Query를 보내 답을 요청한다.

> **반복 쿼리(Iterative Query)란?**<br>Local DNS 서버가 다른 DNS 서버에게 Query를 보내 답을 요청한다.<br>이후 외부 도메인에서 개별 작업을 통해 얻어낸 정보를 종합해서 알려준다.

### DNS 구조

_그림_<br>

### DNS Query

🔹 일반적인 도메인 조회의 경우 클라이언트는 DNS 서버에 **UDP**로 DNS Request를 DNS 서버에 전송한다<br>
🔹 DNS Request의 type 필드에 요청하는 레코드의 구분자를 넣는다.<br>
&emsp;🔹 `A`는 IPv4, `AAAA`는 IPv6 를 의미한다.<br>
🔹 DNS 서버는 해당 DNS Request에 대해 요청한 IP 주소를 포함한 DNS Response로 응답한다.

> **DNS에서 TCP를 사용하는 경우**<br>대부분의 DNS 요청은 UDP가 사용되나, 응답 크기가 512바이트를 초과할 경우 자동으로 TCP로 전환된다.<br>이외에 DNS 존 전송(AXFR), 보안 DNS 등의 경우 TCP가 사용된다.

### DNS 레코드 종류

| **구분**                     | **설명**                                                                                         |
| ---------------------------- | ------------------------------------------------------------------------------------------------ |
| **A (Address)**              | 단일 호스트 이름을 IPv4 주소와 매핑한다.                                                         |
| **AAAA (IPv6 Address)**      | 호스트 이름을 IPv6 주소와 매핑한다.                                                              |
| **PTR (Pointer)**            | 특정 IP 주소를 도메인 이름으로 변환하는 역방향 조회에 사용된다.                                  |
| **NS (Name Server)**         | 도메인 이름을 관리하는 DNS 서버를 지정한다.                                                      |
| **MX (Mail Exchanger)**      | 도메인으로 들어오는 메일을 수신할 서버를 지정한다.                                               |
| **CNAME (Canonical Name)**   | 하나의 호스트 이름을 다른 도메인 이름으로 매핑하여 별칭으로 사용할 수 있게 한다.                 |
| **SOA (Start of Authority)** | 도메인에 대한 관리 정보를 제공하는 기본 DNS 레코드로, 도메인에 대한 권한을 갖는 서버를 표시한다. |
| **ANY (ALL)**                | 해당 도메인의 모든 DNS 레코드 정보를 조회한다.                                                   |

## SMTP(Simple Mail Transfer Protocol)

### SMTP 개요

🔹 TCP 기반의 인터넷 전자 우편 표준 프로토콜이다. (RFC 821에 명시되어있다.)<br>
🔹 Store-and-Forward 방식을 사용한다.

### SMTP 동작 방식

🔹 메일 서버는 수신자의 전자우편 주소를 분석해 최단 경로를 찾아 근접한 메일 서버에게 편지를 전달한다.<br>
🔹 최종 수신자 측 메일 서버에 도착하기 전까지 연속적으로 전달하는 중계 작업을 수행한다.<br>

### SMTP 구성 요소

| **구성 요소**                 | **설명**                                                          |
| ----------------------------- | ----------------------------------------------------------------- |
| **MTA (Mail Transfer Agent)** | 메일을 전송하는 서버이다.                                         |
| **MDA (Mail Delivery Agent)** | MTA에서 받은 메일을 사용자에게 전달한다.                          |
| **MUA (Mail User Agent)**     | 사용자가 메일을 주고받을 때 사용하는 클라이언트 애플리케이션이다. |

### POP3, IMAP 및 IMAP3

| **POP3**                                                                                                                                                          | **IMAP 및 IMAP3**                                                                                |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ |
| 🔹 TCP 110번 포트를 사용한다.<br>🔹 메일 서버에 접속해 저장된 메일을 내려 받는 MDA 프로그램이다.<br>🔹 메일을 내려받은 후 메일 서버에서 해당 메일을 **삭제**한다. | 🔹 TCP 143번, 993번 포트를 사용한다.<br>🔹 메일을 내려받아도 메일 서버의 원본을 삭제하지 않는다. |

## SNMP(Simple Network Management Protocol)

### SNMP 개요

🔹 UDP 기반의 네트워크 관리 시스템이다.<br>
🔹 네트워크의 안정성, 효율성을 높이기 위해 구성, 장애, 통계, 상태 정보를 실시간으로 수집 및 분석한다.

### SNMP 명령어

| **명령어**   | **설명**                                                           |
| ------------ | ------------------------------------------------------------------ |
| **Get**      | 장비의 상태 및 기록 시간 등의 관리 정보를 읽는다.                  |
| **Get-Next** | 정보가 계층적 구조를 가지므로, 조회를 통해 하위 층 정보를 읽는다.  |
| **Set**      | 장비 MIB를 조작하여 장비 설정을 변경하거나 재구성한다.             |
| **Trap**     | 미리 설정된 유형의 보고서를 생성한다. (Event, Agent, 고장 통지 등) |

## DHCP(Dynamic Host Configuration Protocol)

### DHCP 개요

🔹 UDP 기반의 IP 주소를 동적으로 할당해주는 표준 프로토콜이다.<br>
🔹 IP 주소와 서브넷 마스크, 게이트웨이 주소 등을 고정하지 않고 네트워크에 처음 연결할 때 동적으로 설정한다.

### DHCP 기능

🔹 DHCP 서버가 관리하는 주소 목록에서 접속한 컴퓨터 시스템에게 IP 주소를 할당해준다.<br>
🔹 DHCP 서버가 관리하는 IP 주소보다 더 많은 컴퓨터 시스템이 접속하면 임대 DHCP를 사용해서 일정한 시간 동안만 IP 주소를 사용하게 할당해준다.<br>

### DHCP 동작 방법

1. **DHCP 클라이언트**가 DHCP Discover 메시지를 브로드캐스트해 DHCP 서버를 찾는다.
2. **DHCP 서버**가 DHCP Offer 메시지를 브로드캐스트해 임의의 IP 주소를 할당해 줄 수 있다고 알린다.
3. **DHCP 클라이언트**가 DHCP 서버에 DHCP Request 메시지를 브로드캐스트해 IP 주소를 요청한다.
4. **DHCP 서버**가 DHCP ACK 메시지를 전송해 IP 주소와 임대 기간을 전송한다.

> DHCP ACK 메시지는 브로드캐스팅과 유니캐스팅 방식을 사용할 수 있으며, Flag값에 따라 구분할 수 있다.<br> 1이면 브로드캐스트, 0이면 유니캐스트이다.
